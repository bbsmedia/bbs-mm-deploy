<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex">  <meta name="built-on" content="2023-11-18T23:40:59.156182"><meta name="build-number" content="${buildNumber}">       <title>Helper functions | Mattermost deployment</title><script id="virtual-toc-data" type="application/json">[]</script><script id="topic-shortcuts" type="application/json"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.1.5-b176/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Helper functions | Mattermost deployment"/><meta property="og:description" content=""/><meta property="og:image" content=""/><meta property="og:site_name" content="Mattermost deployment Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="/mdMM-DEP/1.0.0/helper-functions.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Helper functions | Mattermost deployment"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "/mdMM-DEP/1.0.0/helper-functions.html#webpage", "url": "/mdMM-DEP/1.0.0/helper-functions.html", "name": "Helper functions | Mattermost deployment", "description": "", "image": "", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "/mdMM-DEP/#website", "url": "/mdMM-DEP/", "name": "Mattermost deployment Help" }</script><!-- End Schema.org --> <!-- Mermaid light/dark themes -->  <link rel="stylesheet" type="text/css" href="mermaid.css">  </head>     <body data-id="Helper-functions" data-main-title="Helper functions" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs="Scripts.md|Scripts"  >   <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Mattermost deployment 1.0.0 Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Helper-functions"  id="Helper-functions.md"  >Helper functions</h1>  <p id="14448cbb_68">The provided code contains two shell functions: <code class="code" id="14448cbb_69">rotate_backups</code> and <code class="code" id="14448cbb_70">create_info</code>. Let's break down each function and understand what it does.</p><ol class="list _decimal" id="14448cbb_71"  type="1"  ><li class="list__item" id="14448cbb_72"><p id="14448cbb_73"><span class="control" id="14448cbb_74">rotate_backups:</span> This function rotates backups by moving existing backups to a higher numbered directory and deleting the oldest backup if the maximum backup limit has been reached.</p><p id="14448cbb_75">Here's how the function works:</p><ul class="list _ul" id="14448cbb_76"    ><li class="list__item" id="14448cbb_77"><p>It takes four parameters: <code class="code" id="14448cbb_78">BACKUP_PATH</code>, <code class="code" id="14448cbb_79">CURRENT_BACKUP_DIR</code>, <code class="code" id="14448cbb_80">BASE_BACKUP_DIR_NAME</code>, and <code class="code" id="14448cbb_81">MAX_BACKUPS</code>.</p></li><li class="list__item" id="14448cbb_82"><p>It checks if the <code class="code" id="14448cbb_83">BACKUP_PATH</code> directory exists. If not, it prints an error message and returns <code class="code" id="14448cbb_84">1</code>.</p></li><li class="list__item" id="14448cbb_85"><p>It changes the current directory to the <code class="code" id="14448cbb_86">BACKUP_PATH</code> using <code class="code" id="14448cbb_87">cd &quot;$BACKUP_PATH&quot;</code> (assuming the directory exists).</p></li><li class="list__item" id="14448cbb_88"><p>It checks if the maximum number of backups (<code class="code" id="14448cbb_89">MAX_BACKUPS</code>) has been reached. If so, it deletes the oldest backup (<code class="code" id="14448cbb_90">&quot;$BASE_BACKUP_DIR_NAME$MAX_BACKUPS&quot;</code>) using <code class="code" id="14448cbb_91">rm -rf</code>.</p></li><li class="list__item" id="14448cbb_92"><p>It then iterates from <code class="code" id="14448cbb_93">(MAX_BACKUPS-1)</code> to <code class="code" id="14448cbb_94">1</code> in reverse order. For each iteration, it checks if the backup directory exists (<code class="code" id="14448cbb_95">&quot;$BASE_BACKUP_DIR_NAME$i&quot;</code>). If it does, it renames it to the next number (<code class="code" id="14448cbb_96">&quot;$BASE_BACKUP_DIR_NAME$((i+1))&quot;</code>) using <code class="code" id="14448cbb_97">mv</code>.</p></li><li class="list__item" id="14448cbb_98"><p>Finally, it renames the previous current backup directory (<code class="code" id="14448cbb_99">&quot;$CURRENT_BACKUP_DIR&quot;</code>) to <code class="code" id="14448cbb_100">&quot;$BASE_BACKUP_DIR_NAME&quot;1</code> using <code class="code" id="14448cbb_101">mv</code>.</p></li></ul></li><li class="list__item" id="14448cbb_102"><p id="14448cbb_103"><span class="control" id="14448cbb_104">create_info:</span> This function creates an info file with metadata about a Mattermost backup session.</p><p id="14448cbb_105">Here's how the function works:</p><ul class="list _ul" id="14448cbb_106"    ><li class="list__item" id="14448cbb_107"><p>It takes four parameters: <code class="code" id="14448cbb_108">BACKUP_PATH</code>, <code class="code" id="14448cbb_109">INFO_FILE</code>, <code class="code" id="14448cbb_110">CHAT_BACKUP</code>, and <code class="code" id="14448cbb_111">DB_BACKUP</code>.</p></li><li class="list__item" id="14448cbb_112"><p>It calculates the sizes of the <code class="code" id="14448cbb_113">CHAT_BACKUP</code> and <code class="code" id="14448cbb_114">DB_BACKUP</code> directories using <code class="code" id="14448cbb_115">du -sh</code> and <code class="code" id="14448cbb_116">awk</code>.</p></li><li class="list__item" id="14448cbb_117"><p>It creates an empty info file at <code class="code" id="14448cbb_118">&quot;$BACKUP_PATH/$INFO_FILE&quot;</code> using <code class="code" id="14448cbb_119">touch</code>.</p></li><li class="list__item" id="14448cbb_120"><p>It appends data to the info file using curly-brace grouping and redirection (<code class="code" id="14448cbb_121">{ } &gt;&gt; &quot;$BACKUP_PATH/$INFO_FILE&quot;</code>). The data includes: </p><ul class="list _ul" id="14448cbb_122"    ><li class="list__item" id="14448cbb_123"><p>A comment line indicating it's a Mattermost backup session.</p></li><li class="list__item" id="14448cbb_124"><p>Backup date and time (<code class="code" id="14448cbb_125">BACKUP_DATE</code>) using the <code class="code" id="14448cbb_126">date</code> command.</p></li><li class="list__item" id="14448cbb_127"><p>Mattermost backup size (<code class="code" id="14448cbb_128">MM_BACKUP_SIZE</code>).</p></li><li class="list__item" id="14448cbb_129"><p>Database backup size (<code class="code" id="14448cbb_130">DB_BACKUP_SIZE</code>).</p></li></ul></li></ul></li></ol><p id="14448cbb_131">These functions provide functionality for rotating backups and creating an info file with metadata for a Mattermost backup session.</p><div class="last-modified"> Last modified: 18 November 2023</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="kill-script.html">kill script</a>   <a class="navigation-links__next" href="light-house-option.html">Watchtower option</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/writerside/apidoc/6.1.5-b176/app.js"></script></body></html>